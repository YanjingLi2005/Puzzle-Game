<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ç¢ç‰‡å¯»è¸ª - æ¸¸æˆä¸»é¡µ</title>
  <style>
    body {
      font-family: 'Press Start 2P', monospace;
      background-color: #fffbe6;
      color: #333;
      text-align: center;
      padding: 20px;
    }
    h1 {
      color: #ffcc00;
      text-shadow: 1px 1px 2px #aaa;
    }
    .button {
      display: inline-block;
      margin: 10px;
      padding: 10px 20px;
      font-size: 14px;
      background-color: #ffd633;
      border: none;
      border-radius: 10px;
      box-shadow: 2px 2px 0 #aaa;
      cursor: pointer;
      font-family: 'Press Start 2P', monospace;
      user-select: none;
    }
    .fragment-counter {
      font-size: 16px;
      margin-top: 20px;
    }
    canvas {
      border: 2px dashed #ccc;
      margin-top: 20px;
      border-radius: 15px;
      background: linear-gradient(to top, #87ceeb 0%, #a0d8ef 70%, #ffffff 100%);
      display: block;
      margin-left: auto;
      margin-right: auto;
    }
    #puzzle {
      width: 320px;
      height: 320px;
      margin: 20px auto;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      grid-template-rows: repeat(4, 1fr);
      gap: 1px;
    }
    .tile {
      width: 80px;
      height: 80px;
      background-size: 320px 320px;
      border: 1px solid #ccc;
      cursor: grab;
      user-select: none;
    }
    #message {
      font-size: 18px;
      margin-top: 15px;
      color: #e67300;
      font-weight: bold;
      min-height: 24px;
    }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet" />
</head>
<body>
  <h1>ç¢ç‰‡å¯»è¸ª</h1>
  <p>ä½ å¥½ï¼Œé™æ€¡å®å®ï¼é€‰æ‹©ä½ çš„æŒ‘æˆ˜ï¼š</p>

  <div>
    <button class="button" onclick="startGastownPuzzle()">Gastown æ‹¼å›¾</button>
    <button class="button" onclick="startFlightGame()">èˆªçº¿å¤§ä½œæˆ˜</button>
    <button class="button" onclick="startKayakGame()">çš®åˆ’è‰‡æŒ‘æˆ˜</button>
  </div>

  <div class="fragment-counter" id="fragmentCounter">å½“å‰ç¢ç‰‡ï¼š0 / 50</div>

  <div id="game-container"></div>

  <script>
    let fragmentCount = 0;
    const container = document.getElementById("game-container");
    const counter = document.getElementById("fragmentCounter");

    function updateCounter() {
      counter.innerText = `å½“å‰ç¢ç‰‡ï¼š${fragmentCount} / 50`;
    }

    // === Gastown æ‹¼å›¾ ===
    function startGastownPuzzle() {
      container.innerHTML = `
        <h2>Gastown å¤œé—´æ‹¼å›¾</h2>
        <p>æ‹–åŠ¨æ¯å—æ‹¼å›¾åˆ°æ­£ç¡®çš„ä½ç½®ã€‚å…± 4x4 æ‹¼å›¾ï¼Œè¯·è®¤çœŸè§‚å¯Ÿå›¾æ¡ˆï¼</p>
        <div id="puzzle"></div>
        <p id="message"></p>
      `;

      const puzzle = document.getElementById("puzzle");
      const message = document.getElementById("message");
      const size = 4;
      let tiles = [];

      for (let y = 0; y < size; y++) {
        for (let x = 0; x < size; x++) {
          const tile = document.createElement("div");
          tile.className = "tile";
          tile.style.backgroundImage = "url('https://i.imgur.com/5LNUa1Q.png')";
          tile.style.backgroundPosition = `-${x * 80}px -${y * 80}px`;
          tile.dataset.correct = `${y * size + x}`;
          tiles.push(tile);
        }
      }

      tiles.sort(() => Math.random() - 0.5);
      tiles.forEach((tile, idx) => {
        tile.dataset.index = idx;
        tile.draggable = true;
        tile.addEventListener("dragstart", dragStart);
        tile.addEventListener("dragover", dragOver);
        tile.addEventListener("drop", drop);
        puzzle.appendChild(tile);
      });

      let dragged;

      function dragStart(e) {
        dragged = e.target;
      }

      function dragOver(e) {
        e.preventDefault();
      }

      function drop(e) {
        e.preventDefault();
        if (dragged !== e.target) {
          const from = dragged.dataset.index;
          const to = e.target.dataset.index;

          puzzle.insertBefore(dragged, puzzle.children[to]);
          puzzle.insertBefore(e.target, puzzle.children[from]);

          updateIndices();
          checkWin();
        }
      }

      function updateIndices() {
        Array.from(puzzle.children).forEach((tile, idx) => {
          tile.dataset.index = idx;
        });
      }

      function checkWin() {
        const isCorrect = Array.from(puzzle.children).every((tile, idx) => tile.dataset.correct == idx);
        if (isCorrect) {
          message.textContent = "ğŸ‰ æ‹¼å›¾æˆåŠŸï¼ä½ è·å¾—äº†ä¸€ä¸ªç¢ç‰‡ï¼";
          fragmentCount++;
          updateCounter();
        } else {
          message.textContent = "";
        }
      }
    }

    // === èˆªçº¿å¤§ä½œæˆ˜ ===
    function startFlightGame() {
      container.innerHTML = `
        <h2>èˆªçº¿å¤§ä½œæˆ˜ï¼šYVR âœˆï¸ SAN</h2>
        <p>ä½¿ç”¨æ–¹å‘é”®ï¼ˆâ†‘ â†“ â† â†’ï¼‰ç§»åŠ¨é£æœºï¼ŒæŠµè¾¾ç»ˆç‚¹ï¼</p>
        <canvas id="mazeCanvas" width="320" height="320"></canvas>
        <p id="message"></p>
      `;
      const canvas = document.getElementById("mazeCanvas");
      const ctx = canvas.getContext("2d");

      const grid = [
        [0,0,1,0,0,0,0,0],
        [0,1,1,0,1,1,1,0],
        [0,0,0,0,0,1,0,0],
        [1,1,1,1,0,1,0,1],
        [0,0,0,1,0,0,0,0],
        [0,1,0,0,1,1,1,0],
        [0,1,1,0,0,0,0,0],
        [0,0,0,0,1,1,1,2]
      ];
      const tileSize = 40;
      let x = 0, y = 0;

      function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        for (let i = 0; i < 8; i++) {
          for (let j = 0; j < 8; j++) {
            if (grid[i][j] === 1) {
              ctx.fillStyle = "#999";
              ctx.fillRect(j * tileSize, i * tileSize, tileSize, tileSize);
            } else if (grid[i][j] === 2) {
              ctx.fillStyle = "#4caf50";
              ctx.fillRect(j * tileSize, i * tileSize, tileSize, tileSize);
            }
          }
        }
        ctx.fillStyle = "#ff0000";
        ctx.fillRect(x * tileSize + 10, y * tileSize + 10, 20, 20);
      }

      draw();

      function keyHandler(e) {
        let dx = 0, dy = 0;
        if (e.key === "ArrowUp") dy = -1;
        else if (e.key === "ArrowDown") dy = 1;
        else if (e.key === "ArrowLeft") dx = -1;
        else if (e.key === "ArrowRight") dx = 1;

        const newX = x + dx;
        const newY = y + dy;
        if (
          newX >= 0 && newX < 8 &&
          newY >= 0 && newY < 8 &&
          grid[newY][newX] !== 1
        ) {
          x = newX;
          y = newY;
          draw();
          if (grid[y][x] === 2) {
            document.removeEventListener("keydown", keyHandler);
            setTimeout(() => {
              alert("ğŸ‰ æˆåŠŸæŠµè¾¾æ¸©å“¥åï¼ç¢ç‰‡ +1ï¼");
              fragmentCount++;
              updateCounter();
              container.innerHTML = '<p>æ¸¸æˆç»“æŸï¼Œè¿”å›é¦–é¡µé€‰æ‹©å…¶ä»–æŒ‘æˆ˜ã€‚</p>';
            }, 100);
          }
        }
      }
      document.addEventListener("keydown", keyHandler);
    }

    // === çš®åˆ’è‰‡æŒ‘æˆ˜ ===
    function startKayakGame() {
      container.innerHTML = `
        <h2>çš®åˆ’è‰‡æŒ‘æˆ˜</h2>
        <p>ç”¨å·¦å³æ–¹å‘é”®æ§åˆ¶çš®åˆ’è‰‡ï¼Œèº²é¿æµªèŠ±ï¼Œæ¥ä½æ°´æ¯å’ŒèƒèŸ¹ï¼è¾¾åˆ° 1000 åˆ†åŠä»¥ä¸Šå¯è·å¾—ç¢ç‰‡å¥–åŠ±ã€‚</p>
        <canvas id="kayakCanvas" width="400" height="300"></canvas>
        <div id="message"></div>
        <button class="button" id="restartBtn" style="display:none; margin-top:15px;">é‡æ–°å¼€å§‹</button>
      `;

      const canvas = document.getElementById("kayakCanvas");
      const ctx = canvas.getContext("2d");
      const messageEl = document.getElementById("message");
      const restartBtn = document.getElementById("restartBtn");

      let kayakX = canvas.width / 2 - 20;
      const kayakY = canvas.height - 60;
      const kayakWidth = 40;
      const kayakHeight = 40;

      let items = []; // æµªèŠ±ã€æ°´æ¯ã€èƒèŸ¹
      let gameOver = false;
      let leftPressed = false;
      let rightPressed = false;
      let score = 0;
      let lastItemTime = 0;
      const itemInterval = 700;

      // å®šä¹‰ç‰©å“ç±»å‹
      // wave: æµªèŠ±ï¼ˆèº²é¿ï¼‰ï¼Œjellyfish: æ°´æ¯ï¼ˆ+10åˆ†ï¼‰ï¼Œcrab: èƒèŸ¹ï¼ˆ+20åˆ†ï¼‰
      // æ¯ä¸ªç‰©å“æœ‰x,y,size,type
      const ITEM_TYPES = [
        {type: 'wave', color: '#3399ff', size: 30},      // æµªèŠ± è“è‰²åœ†
        {type: 'jellyfish', color: '#cc33ff', size: 25}, // æ°´æ¯ ç´«è‰²æ¤­åœ†
        {type: 'crab', color: '#ff3300', size: 20}        // èƒèŸ¹ çº¢è‰²æ–¹å½¢
      ];

      function createItem() {
        // ç”Ÿæˆæ¦‚ç‡ï¼šæµªèŠ±60%ï¼Œæ°´æ¯25%ï¼ŒèƒèŸ¹15%
        const rand = Math.random();
        let itemType;
        if (rand < 0.6) itemType = ITEM_TYPES[0];
        else if (rand < 0.85) itemType = ITEM_TYPES[1];
        else itemType = ITEM_TYPES[2];

        const x = Math.random() * (canvas.width - itemType.size);
        items.push({x, y: -itemType.size, ...itemType});
      }

      function drawKayak() {
        ctx.fillStyle = '#ff9933';
        ctx.beginPath();
        ctx.ellipse(kayakX + kayakWidth/2, kayakY + kayakHeight/2, kayakWidth/2, kayakHeight/2, 0, 0, Math.PI * 2);
        ctx.fill();
        ctx.strokeStyle = '#cc6600';
        ctx.lineWidth = 4;
        ctx.beginPath();
        ctx.moveTo(kayakX + 5, kayakY + kayakHeight/2);
        ctx.lineTo(kayakX + kayakWidth - 5, kayakY + kayakHeight/2);
        ctx.stroke();
      }

      function drawItems() {
        items.forEach(item => {
          ctx.fillStyle = item.color;
          if (item.type === 'wave') {
            ctx.beginPath();
            ctx.arc(item.x + item.size/2, item.y + item.size/2, item.size/2, 0, Math.PI * 2);
            ctx.fill();
          } else if (item.type === 'jellyfish') {
            ctx.beginPath();
            ctx.ellipse(item.x + item.size/2, item.y + item.size/2, item.size/2, item.size/3, 0, 0, Math.PI * 2);
            ctx.fill();
          } else if (item.type === 'crab') {
            ctx.fillRect(item.x, item.y, item.size, item.size);
          }
        });
      }

      function checkCollision() {
        for (let i = 0; i < items.length; i++) {
          const item = items[i];
          if (
            item.y + item.size > kayakY &&
            item.y < kayakY + kayakHeight &&
            item.x + item.size > kayakX &&
            item.x < kayakX + kayakWidth
          ) {
            if (item.type === 'wave') {
              return true; // æ’æµªèŠ± æ¸¸æˆç»“æŸ
            } else {
              // æ¥åˆ°æ°´æ¯æˆ–èƒèŸ¹ï¼Œå¾—åˆ†å¹¶ç§»é™¤è¯¥ç‰©å“
              if (item.type === 'jellyfish') score += 10;
              else if (item.type === 'crab') score += 20;
              items.splice(i, 1);
              i--;
            }
          }
        }
        return false;
      }

      function drawScore() {
        ctx.fillStyle = '#333';
        ctx.font = '20px monospace';
        ctx.fillText(`å¾—åˆ†: ${score}`, 10, 30);
      }

      function gameLoop(timestamp) {
        if (gameOver) return;
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // ç”»æ²™æ»©
        ctx.fillStyle = '#f2d16b';
        ctx.fillRect(0, canvas.height - 40, canvas.width, 40);

        drawKayak();
        drawItems();
        drawScore();

        // ç‰©å“ä¸‹è½
        items.forEach(item => item.y += 4);
        // è¶…å‡ºåº•éƒ¨åˆ é™¤
        items = items.filter(item => item.y < canvas.height);

        if (!lastItemTime) lastItemTime = timestamp;
        if (timestamp - lastItemTime > itemInterval) {
          createItem();
          lastItemTime = timestamp;
        }

        if (leftPressed && kayakX > 0) kayakX -= 6;
        if (rightPressed && kayakX + kayakWidth < canvas.width) kayakX += 6;

        if (checkCollision()) {
          gameOver = true;
          restartBtn.style.display = 'inline-block';
          if (score >= 1000) {
            messageEl.textContent = `ğŸ’¥ æ’åˆ°æµªèŠ±ï¼Œæ¸¸æˆç»“æŸï¼ä½ å¾—äº† ${score} åˆ†ï¼Œè·å¾— 1 ä¸ªç¢ç‰‡ï¼`;
            fragmentCount++;
            updateCounter();
          } else {
            messageEl.textContent = `ğŸ’¥ æ’åˆ°æµªèŠ±ï¼Œæ¸¸æˆç»“æŸï¼ä½ å¾—äº† ${score} åˆ†ï¼Œæœªè¾¾åˆ° 1000 åˆ†ç¢ç‰‡é—¨æ§›ï¼Œç»§ç»­åŠªåŠ›ï¼`;
          }
        } else {
          score++;
          requestAnimationFrame(gameLoop);
        }
      }

      function restartGame() {
        gameOver = false;
        messageEl.textContent = "";
        restartBtn.style.display = 'none';
        items = [];
        kayakX = canvas.width / 2 - 20;
        score = 0;
        lastItemTime = 0;
        gameLoop();
      }

      window.addEventListener('keydown', e => {
        if (e.key === 'ArrowLeft') leftPressed = true;
        else if (e.key === 'ArrowRight') rightPressed = true;
      });

      window.addEventListener('keyup', e => {
        if (e.key === 'ArrowLeft') leftPressed = false;
        else if (e.key === 'ArrowRight') rightPressed = false;
      });

      restartBtn.addEventListener('click', restartGame);

      gameLoop();
    }

  </script>
</body>
</html>
